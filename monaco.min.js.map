{"version":3,"sources":["monaco.js"],"names":["root","factory","define","amd","exports","module","require","Monaco","_","Backbone","localStorage","this","App","Application","appName","options","Error","name","cid","uniqueId","_settings","models","collections","views","RouterClass","Router","router","app","routes","trigger","extend","prototype","Events","start","pushState","has","_addRoutes","history","add","className","object","namespace","_app","get","key","result","JSON","parse","getItem","e","set","value","persist","setItem","stringify","fetchError","error","obj","resp","apply","arguments","_collectionFetch","call","Collection","fetch","_modelFetch","Model","View","_uroutes","_routes","constructor","length","initialize","each","route","push","routeList","isObject","keys","pop","unshift","_getFuncName","fn","toString","match","_addRoute","callback","isString","isArray","History","optionalParam","namedParam","splatParam","escapeRegExp","_routeConstraints","routeKey","find","regexp","_routeToRegExp","constraints","replace","optional","substr","reStr","slice","lastIndexOf","RegExp","filter","filters","controller","next","i","l","_wrapFilter","_filters","bind","addFilter","_getByName","possibleRoutes","map","compact","reverse","params","url","array","ViewManager","parent","_children","listenTo","_onParentRender","_onParentRemove","autoRender","child","$selector","$el","html","render","invoke","_onChildRemove","instance","_addChild","remove","children","methods","method","args","subviews","Promise","then","view","on","local","autoCache","Boolean","cacheExpire","isNull","isNumber","prefetched","data","resource","expire","applicationAdd","Class","isCollection","collection","_getLocalData","decompress","item","idAttribute","id","_ts","_isExpired","modelExpire","_setExpire","_addToCollectionData","compress","_storageSet","_memorySet","clear","_clearItem","_clearAll","localData","caching","j","clone","model","modelRef","silent","revertParse","toJSON","_memoryGet","_memory","_storageGet","_getKey","undefined","newKeys","exception","asProperty","timestamp","date","Date","setMinutes","getMinutes","getTime","now","removeItem","split","collectionInitialize","_cacheCollection","fromLocal","modelInitialize","_cacheModel","sync","localOnly","fresh","success","cacheLocal","customCachePolicy","cachePolicy","status","xhr","getResponseHeader","parseInt","loadUrl","self","matched","pvFragment","fragment","test","trackPageview","ga","experiments","Experiments","_experiments","slot","scope","cookie","prefix","days","baseDomain","experiment","groups","Experiment","optout","index","users","usersPerGroup","Math","floor","size","normalized","_normalizeGroup","utils","setCookie","getCookie","original","current","cookieOpt","groupKey","random","saveGroup","methodName","suffix","ViewClass","template","_gaq","group","count","hasOwnProperty","remaining","transitions","transitionTo","targetView","Transition","currentView","TransitionClass","DefaultTransition","transition","fromView","toView","el"],"mappings":"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","file":"monaco.min.js","sourcesContent":["(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Application monaco class, used to instantiate monaco applications\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n/* -- APPLICATION ------------------------------------------------------ */\nvar App = Monaco.Application = function(appName, options) {\n  if (!appName) {\n    throw new Error('Monaco :: missing required application parameter: appName');\n  }\n\n  options = options || {};\n\n  // Application Unique Name\n  this.name = appName;\n  this.options = options;\n\n  // Application Client Id\n  this.cid = _.uniqueId('app');\n\n  this._settings      = {}; // used internally to store app settings ( get/set )\n  this.models         = {}; // initialize model namespace\n  this.collections    = {}; // initialize collection namespace\n  this.views          = {}; // initialize view namespace\n\n  // create a router instance\n  var RouterClass = options.RouterClass || Monaco.Router;\n  this.router = new RouterClass({app: this, routes: options.routes});\n\n  // trigger a global event for application module setup\n  Monaco.trigger('app:built', this, options);\n};\n\n_.extend(App.prototype, Backbone.Events, {\n  // Start the Monaco application\n  start : function(options) {\n    options = options || {};\n    options.pushState = options.pushState || false;\n\n    // when starting the application an instance of a router should exist\n    if (!_.has(this, 'router')) {\n      throw new Error('Monaco :: missing required router instance before starting the application');\n    }\n\n    // Add all unregistered routes before starting the history\n    this.router._addRoutes();\n\n    Monaco.history.start(options);\n\n    // trigger a global event for application module setup\n    Monaco.trigger('app:initialized', this, options);\n  },\n\n  // Interface used to add objects (models, collections, views and transitions) to your application\n  add : function(className, object) {\n\n    // all objects added through this method needs a namespace\n    if (!object.prototype || !object.prototype.namespace) {\n      throw new Error('Monaco :: missing required object property \\'namespace\\'');\n    }\n\n    // fail on duplicated objects being created on the same namespace\n    if (this[object.prototype.namespace][className]) {\n      throw new Error('Monaco :: ' + className + ' have already been defined in ' + this.name + '.' + object.prototype.namespace);\n    }\n\n    // injects the app reference in the object prototype\n    object.prototype._app = this;\n\n    // adds the object using the proper namespacing\n    this[object.prototype.namespace][className] = object;\n  },\n\n  // App setting get method, returning undefined if not found or any error occurs\n  // todo: return null instead of undefined to comply with the localStorage api\n  get : function(key) {\n    // searchs for the key in memory\n    if (_.has(this._settings, key)) {\n      return this._settings[key];\n    }\n\n    // searchs for the key in local storage\n    var result = null;\n    try {\n      result = JSON.parse(localStorage.getItem(key));\n    } catch( e ) {\n      return void 0;\n    }\n\n    if (result === null) {\n      return void 0;\n    }\n\n    // store the key/value in memory\n    this._settings[key] = result;\n\n    // return the value\n    return result;\n  },\n\n  // App setting set method\n  set : function(key, value, persist) {\n    persist = persist || false;\n    // validation\n    if (key === void 0 || value === void 0) {\n      throw new Error('set method required both key and value parameters { key: ' + key + ' | value: ' + value + ' }');\n    }\n\n    // store the key/value in memory\n    this._settings[key] = value;\n\n    // if persist is set to true then store the key/value in localStorage\n    if (persist === true) {\n      try {\n        localStorage.setItem(key, JSON.stringify(value));\n      } catch(e) {\n        // console.log( 'Warning: fail to persist key: ' + key );\n        return false;\n      }\n    }\n    return true;\n   }\n});\n\n// Allow the `Monaco` object to serve as a global event bus\n_.extend(Monaco, Backbone.Events);\n\n// wraps the error callback to trigger the proper events\nvar fetchError = function(options) {\n  options = options || {};\n\n  var error = options.error,\n      router = ( this._app & this._app.router ) ? this._app.router : null;\n\n  // custom error method that will trigger a custom event before executing\n  // the error callback\n  options.error = function(obj, resp, options) {\n    if (router) {\n      router.trigger('route:fetch.error', obj, resp, options);\n    }\n    if (error) {\n      error.apply(this, arguments);\n    }\n  };\n  return options;\n};\n\n/* -- COLLECTION ------------------------------------------------------- */\n// override the fetch method to add the default error router\nvar _collectionFetch = function(options) {\n  options = fetchError.call(this, options);\n  return Backbone.Collection.prototype.fetch.call(this, options);\n};\n\ntry {\n  Monaco.Collection = Backbone.Collection.extend({\n    // application collection namespace\n    namespace : 'collections',\n\n    // override the fetch method to add the default error router\n    fetch : _collectionFetch\n  });\n}\ncatch(e) {\n  // this addresses an issue with some versions of google browser - better described\n  // by this ticket on backbone: https://github.com/jashkenas/backbone/issues/1475\n  // and this ticket on chrome forum: https://code.google.com/p/chromium/issues/detail?id=136380\n  // sample of user agent where the problem was observed:\n  //\n  // Mozilla/5.0 (Linux; U; Android 4.1.1; tr-tr; Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  // Mozilla/5.0 (Linux; U; Android 4.0.4; en-us; Next7P12-8G Build/IMM76I) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  //\n  // Note that not all Android 4.1.1 or Android 4.0.4 triggered the same misbehaviour\n  Monaco.Collection = Backbone.Collection;\n  Monaco.Collection.prototype.namespace = 'collections';\n  Monaco.Collection.prototype.fetch = _collectionFetch;\n}\n\n    /* -- MODEL ------------------------------------------------------------ */\nvar _modelFetch = function(options) {\n  options = fetchError.call(this, options);\n  return Backbone.Model.prototype.fetch.call(this, options);\n};\n\ntry {\n  Monaco.Model = Backbone.Model.extend({\n    // application model namespace\n    namespace : 'models',\n\n    // override the fetch method to add the default error router\n    fetch : _modelFetch\n  });\n}\ncatch(e) {\n  // this addresses an issue with some versions of google browser - better described\n  // by this ticket on backbone: https://github.com/jashkenas/backbone/issues/1475\n  // and this ticket on chrome forum: https://code.google.com/p/chromium/issues/detail?id=136380\n  // sample of user agent where the problem was observed:\n  //\n  // Mozilla/5.0 (Linux; U; Android 4.1.1; tr-tr; Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  // Mozilla/5.0 (Linux; U; Android 4.0.4; en-us; Next7P12-8G Build/IMM76I) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  //\n  // Note that not all Android 4.1.1 or Android 4.0.4 triggered the same misbehaviour\n\n  Monaco.Model = Backbone.Model;\n  Monaco.Model.prototype.namespace = 'models';\n  Monaco.Model.prototype.fetch = _modelFetch;\n}\n\n/* -- VIEW ------------------------------------------------------------- */\nMonaco.View = Backbone.View.extend({\n  // application view namespace\n  namespace : 'views'\n});\n\n/* -- ROUTER ----------------------------------------------------------- */\nMonaco.Router = Backbone.Router.extend({\n  // undefined routes\n  _uroutes : [],\n\n  // defined routes\n  _routes : [],\n\n  // override the Backbone Router constructor\n  constructor : function(options) {\n    this.app = arguments.length > 0 ? arguments[0].app : void 0;\n    var initialize = this.initialize; // keep the original initialize method\n    // wrap the initialize method to store each route definition\n    this.initialize = function(options) {\n      _.each(options.routes, function(options, route) {\n        this._routes.push({key: route, value: options});\n      }, this);\n      initialize.apply(this, arguments);\n    };\n    Backbone.Router.prototype.constructor.apply(this, arguments);\n  },\n\n  // stores routes that will be added when the application starts\n  add : function(routes) {\n    var route, routeList;\n    if (!routes || !_.isObject(routes)) {\n      throw new Error('invalid routes format - please check the docs');\n    }\n    routeList = _.keys(routes);\n\n    while ((route = routeList.pop())) {\n      this._uroutes.unshift({key: route, value: routes[route]});\n    }\n  },\n\n  // tries to retrieve the original function name\n  _getFuncName : function(fn) {\n    var name;\n\n    if (typeof fn !== 'function' ) {\n      return; //undefined\n    }\n    // browser supports the new es6 function.name\n    else if (fn.name) {\n      return fn.name;\n    }\n    // old browser fallback implementation\n    else {\n      name = fn.toString().match(/function ([^\\(]+)/);\n      if (name && name[1]) {\n        return name[1];\n      }\n    }\n\n    return; // undefined if it couldn't figure it out\n  },\n\n  // adds all undefined routes into Backbone.Router\n  _addRoutes : function() {\n    var route;\n    while((route = this._uroutes.pop())) {\n      // this needs to be added to the _route list before the route gets added to the Router.\n      this._routes.push(route);\n      this._addRoute(route.key, route.value);\n    }\n  },\n\n  // adds one route into Backbone.Router\n  _addRoute : function(route, options) {\n    var name,\n        callback;\n\n    options = options || {};\n\n    if (route !== '' && !route) {\n      throw new Error('invalid route: ' + route);\n    }\n\n    if (_.isString(options)) {\n      name = options;\n    }\n    else if (_.isArray(options) && options.length > 0) {\n      name = options[0];\n      if (typeof name === 'function') {\n        callback = name;\n        name = this._getFuncName(callback) || '';\n      }\n      else if (typeof options[1] === 'function') {\n        callback = options[1];\n      }\n    }\n    else {\n      throw new Error('monaco :: invalid route options from route: ' + route );\n    }\n\n    if (!name || !_.isString(name) || (name === '' && !callback)) {\n      throw new Error('invalid callback (name) from route: ' + route);\n    }\n\n    return this.route(route, name, callback);\n  }\n});\n\n/* -- HISTORY ----------------------------------------------------------- */\nMonaco.History = Backbone.History;\n\n// Creates a reference to Backbone history instance in Monaco\nMonaco.history = Backbone.history;\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Router monaco class to facilitate application routing\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n/* -- ROUTER ----------------------------------------------------------- */\n// Cached regular expressions for matching named param parts and splatted\n// parts of route strings.\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam    = /(\\(\\?)?:\\w+/g;\nvar splatParam    = /\\*\\w+/g;\nvar escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n// return the regexp option of the specific router if available\n// otherwise undefined will be returned\nMonaco.Router.prototype._routeConstraints = function(routeKey) {\n  // var value = this._routes[route];\n  var route = _.find(this._routes, function(route) {\n    return route.key === routeKey;\n  });\n  if (route && route.value && _.isArray(route.value) && route.value.length > 1 && _.isObject(route.value[1])) {\n    return route.value[1].regexp;\n  }\n  return void 0;\n};\n\n// override the original Backbone method to deal with the regex constraints\nMonaco.Router.prototype._routeToRegExp = function(route) {\n  var constraints = this._routeConstraints(route);\n  route = route.replace(escapeRegExp, '\\\\$&')\n               .replace(optionalParam, '(?:$1)?')\n               .replace(namedParam, function(match, optional){\n                  // this `if` is the only difference from the original method from Backbone\n                  if (constraints && constraints[match.substr(1)]) {\n                    var reStr = constraints[match.substr(1)].toString();\n                    return '(' + reStr.slice(1, reStr.lastIndexOf('/')) + ')';\n                  }\n                  return optional ? match : '([^\\/]+)';\n               })\n               .replace(splatParam, '(.*?)');\n  return new RegExp('^' + route + '$');\n};\n\nMonaco.Router.prototype.filter = function(filters, controller) {\n  var next;\n  for (var i = (filters.length - 1) , l = 0; i >= l; i-- ) {\n    next = controller;\n    controller = this._wrapFilter(filters[i], next);\n  }\n\n  return controller;\n};\n\n// internal list of filters\nMonaco.Router.prototype._filters = {};\n\nMonaco.Router.prototype._wrapFilter = function(filter, next) {\n  return _.bind(function() {\n    this._filters[filter].call(this, next, arguments);\n  }, this);\n};\n\n// adds a filter method to list of filters\nMonaco.Router.prototype.addFilter = function(name, callback) {\n  if (this._filters[name]) {\n    throw new Error('Monaco :: filter already exists: ' + name);\n  }\n  this._filters[name] = callback;\n};\n\n// returns the original route definition based on the url name informed\nMonaco.Router.prototype._getByName = function(name) {\n  var possibleRoutes = _.map(this._routes, function(options, route) {\n    if (_.isArray(options) && options.length > 1) {\n      if ((_.isString(options[1]) && options[1] === name) ||\n          (_.isObject(options[1]) && options.name === name)) {\n        return route;\n      }\n    }\n    return null;\n  });\n\n  var route = _.compact(possibleRoutes);\n  if (route.length > 0) {\n    return route[0];\n  }\n  return false;\n};\n\n// returns a reverse url based on the url name and parameters passed to it.\n// This url won't be validated against the regexp constraints even if available.\n// Neither it will validate if you provided enough parameters, the missing\n// parameters will be displayed as the original url definition.\nMonaco.Router.prototype.reverse = function(name, params) {\n  var url = '';\n  params = params || {};\n  if (!name) {\n    throw new Error('Monaco :: required `name` parameter for `reverse` method');\n  }\n\n  url = this._getByName(name);\n  _.each(params, function(value, key) {\n    url = url.replace(':'+key, value);\n  });\n\n  return url;\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\nvar array = [];\nvar slice = array.slice;\n\n/*\n * View Manager Constructor\n */\nvar ViewManager = Monaco.ViewManager = function(parent, options) {\n  // manager options\n  this.options = options || {};\n\n  // internal sub-views object\n  this._children = {};\n\n  // when a parent is informed it will manage the subviews according to\n  // parent's events\n  // this method uses the parent, but DOES NOT keep a reference to it\n  if (parent && parent instanceof Monaco.View) {\n    this.listenTo(parent, 'rendered', this._onParentRender);\n    this.listenTo(parent, 'beforeRemove', this._onParentRemove);\n  }\n};\n\n/*\n * View Manager extended methods\n */\nViewManager.prototype = _.extend(ViewManager.prototype, {\n\n  /*\n   * Handler triggered after parent view is rendered\n   *    - when developer didn't specifically state that subviews shouldn't be auto-rendered\n   *    - when subview key matches a valid parent selector\n   */\n  _onParentRender: function(parent) {\n    if (this.options.autoRender !== false) {\n      this.each(function(child, key) {\n        var $selector = parent.$el.find(key);\n        if ($selector.length > 0) {\n          $selector.html( child.render().$el );\n        }\n      }, this);\n    }\n  },\n\n  /*\n   * Handler triggered just before the parent view is removed the DOM\n   */\n  _onParentRemove: function() {\n    // this will invoke the 'remove' method of each child view\n    this.invoke( 'remove' );\n  },\n\n  /*\n   * Handler triggered after a child has been removed from the DOM\n   */\n  _onChildRemove: function(instance) {\n    // removes the reference to the dead instance\n    var name = this.find(this._children, {cid: instance.cid});\n    if (name) {\n      this._children[name] = void 0;\n    }\n  },\n\n  /*\n   * internal method that adds a child view to this manager\n   */\n  _addChild: function(name, instance) {\n    if (this._children[name]) {\n      this._children[name].remove();\n    }\n\n    this._children[name] = instance;\n    this.listenTo(this._children[name], 'remove', this._onChildRemove);\n    return this._children[name];\n  },\n\n  /*\n   * public method to add a child view to this manager\n   */\n  add: function(name, instance) {\n    var children = {};\n\n    if (typeof name === 'string' && name !== '' && instance instanceof Monaco.View) {\n      children[name] = instance;\n    }\n    else if (typeof name === 'object') {\n      children = name;\n      instance = name; // return value\n    }\n    else {\n      throw new Error('Monaco.ViewManager :: invalid parameters when setting subviews');\n    }\n\n    _.each(children, function(value, key) {\n      if (typeof key === 'string' && key !== '' && value instanceof Monaco.View) {\n        this._addChild(key, value);\n      }\n    }, this );\n\n    // returns instance being set, or in case of bulk set returns original object\n    return instance;\n  },\n\n  /*\n   * public method to set a child view to this manager (`add` shortcut)\n   */\n  set: function() {\n    return this.add.apply(this, arguments);\n  },\n\n  /*\n   * public method to get a child from this manager\n   */\n  get: function(name) {\n    return this._children[name];\n  }\n});\n\n// Mix in each Underscore method as a proxy to View#sub-views\nvar methods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl',\n    'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select',\n    'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke',\n    'max', 'min', 'toArray', 'size', 'shuffle', 'isEmpty', 'chain', 'sample',\n    'partition'];\n\n_.each(methods, function(method) {\n  if (!_[method]) {\n    return;\n  }\n  ViewManager.prototype[method] = function() {\n    var args = slice.call(arguments);\n    args.unshift(this._children);\n    return _[method].apply(_, args);\n  };\n});\n\nvar View = Monaco.View;\nMonaco.View = View.extend({\n\n  // constructor\n  constructor: function(options) {\n    options = options || {};\n\n    // call the original constructor method\n    View.prototype.constructor.apply(this, arguments);\n\n    // create a subviews from ViewManager\n    this.subviews = new Monaco.ViewManager(this, options);\n\n    // overrides the view render to trigger an event\n    var render = this.render;\n    this.render = _.bind(function monacoViewRender() {\n      var result;\n\n      // call the original render caching the result;\n      result = render.apply(this, arguments);\n\n      if (Promise && result instanceof Promise) {\n        return result.then( function( view ) {\n          view.trigger('rendered', view);\n        } );\n      }\n      else {\n        this.trigger('rendered', this);\n        return result;\n      }\n    }, this);\n\n    // overrides the view remove to trigger an event\n    var remove = this.remove;\n    this.remove = _.bind(function monacoViewRemove() {\n      var result;\n\n      this.trigger('beforeRemove', this);\n      // call the original remove caching the result;\n      result = remove.apply(this, arguments);\n\n      if (Promise && result instanceof Promise) {\n        return result.then( function( view ) {\n          view.trigger('rendered', view);\n        } );\n      }\n      else {\n        this.trigger('removed', this);\n        return result;\n      }\n    }, this);\n  }\n\n});\n\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates a caching layer for Collections and Models, in order to avoid unnecessary\n * requests to the server\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// Local Cache Application setup\nMonaco.on('app:built', function(app, options) {\n  // set a reference to the application into the local cache\n  app.local._app = app;\n\n  // check the global cacheLocal property for the application\n  if (_.has(options, 'cacheLocal')) {\n    app.local.autoCache = Boolean(_.result(options, 'cacheLocal'));\n  }\n\n  // check the global cacheExpire property for the application\n  if (_.has(options, 'cacheExpire')) {\n    var cacheExpire = _.result(options, 'cacheExpire');\n    app.local.cacheExpire = (_.isNull(cacheExpire) || _.isNumber(cacheExpire)) ? cacheExpire : void 0;\n  }\n\n  // cache any prefetched data for later use on the application\n  if (options.prefetched) {\n    _.each(options.prefetched, function(value, key) {\n      if (!value.data) {\n        return;\n      }\n      this.local.set({resource: key, models:[]}, value.data, value.expire);\n    }, app);\n    delete app.options.prefetched;\n  }\n});\n\n// overrides Monaco.Application add method to check for the required `resources` property\nvar applicationAdd = Monaco.Application.prototype.add;\nMonaco.Application.prototype.add = function(className, Class) {\n  if (Class.prototype.namespace === 'collections' && (!Class.prototype.resource || Class.prototype.resource === '')) {\n    throw new Error('Monaco :: required `resource` property missing from this collection definition');\n  }\n  return applicationAdd.apply(this, arguments);\n};\n\n// Application Local Cache Object\nMonaco.Application.prototype.local = {\n  // by default the application won't auto cache your api calls\n  autoCache : false,\n\n  // default cache expire (in minutes) if you enable local caching\n  cacheExpire : 30,\n\n  // get an object from local cache\n  // return null instead of undefined to comply with the localStorage getItem api\n  get : function( obj ) {\n    var isCollection = _.has(obj, 'models'),\n        collection = isCollection ? obj : (obj.collection || null),\n        resource = collection ? _.result(collection, 'resource') : _.result(obj, 'resource');\n\n    if (resource) {\n      var data = this._getLocalData(resource);\n      if (data) {\n        data.resp = this.decompress(data.resp);\n\n        // get cached model\n        if (!isCollection) {\n          // extract data from model linked with a collection\n          if (collection) {\n            data = _.find(collection.parse(data.resp), function(item) {\n              return item[obj.idAttribute] === obj.id;\n            });\n\n            // only this case needs to retest the expiration, since the expiration tested\n            // in _getLocalData was from the collection, and the model might have its own\n            // expiration rule\n            if (data && (!data._ts || !this._isExpired(data))) {\n              delete data._ts; // remove possible timestamp property\n              return data;\n            }\n          }\n\n          // extract data from model not linked with any collection\n          else if(data.resp[obj.idAttribute] === obj.id) {\n            return data.resp;\n          }\n        }\n        // get cached collection\n        else {\n          return data.resp;\n        }\n      }\n    }\n    return void 0;\n  },\n\n  // set an object in local cache\n  set : function(obj, data, expire) {\n    var isCollection = _.has(obj, 'models'),\n        collection = isCollection ? obj : obj.collection || null,\n        resource = collection ? _.result(collection, 'resource') : _.result(obj, 'resource');\n\n    // an expire option will override any instance or class defined expiration\n    expire = (expire !== void 0) ? expire : false;\n\n    // don't cache if resource property is not available\n    if (!resource) {\n      return;\n    }\n\n    // caching Model linked with Collection\n    if (!isCollection && collection) {\n      // in case the model has expireLocal set for\n      var modelExpire = expire || _.result(obj, 'expireLocal') ;\n      if (modelExpire) {\n          data = this._setExpire(data, modelExpire, true);\n      }\n      data = this._addToCollectionData(obj, data, collection);\n\n      expire = (expire !== false) ? expire : _.result(collection, 'expireLocal');\n    }\n\n    // Collections or Models NOT linked with any Collection\n    else {\n      expire = (expire !== false) ? expire : _.result(obj, 'expireLocal');\n    }\n\n    data = this.compress(data);\n    data = this._setExpire(data, expire);\n\n    this._storageSet(resource, data);\n    this._memorySet(resource, data);\n    return true;\n  },\n\n  // clear a specific resource or all resources\n  clear : function(resource) {\n    resource = resource || null;\n    if (!resource) {\n      return this._clearAll();\n    }\n    return this._clearItem(resource);\n  },\n\n  // compress data to be stored - override this with your own data compress implementation\n  compress : function(data) { return data; },\n\n  // decompress data - override this with your own data decompress implementation\n  decompress : function(data) { return data; },\n\n  // get the local data for a collection resource\n  _getLocalData : function(resource) {\n    var localData = null,\n        caching = ['memory', 'storage'];\n\n    for (var i = 0, j = caching.length; i < j; i++) {\n      localData = this['_'+caching[i]+'Get'](resource);\n      if (localData && !this._isExpired(localData)) {\n        if (caching[i] === 'storage') {\n         this._memorySet(resource, localData);\n        }\n        return _.clone(localData);\n      }\n      // todo: add an option on the local caching setup that allows it to control\n      //       the following behaviour\n      // clean up the expired data\n      else if(localData) {\n        this.clear(resource);\n      }\n    }\n\n    return null;\n  },\n\n  // merge the model with the collection data, returning the new collection data\n  // as if it was the data requested from the server\n  _addToCollectionData : function(model, data, collection) {\n\n    var modelRef = collection.get( model.id );\n    if ( modelRef ) {\n      // todo: verify if this should or shouldn't happen silently\n      modelRef.set( data, { silent: true } );\n    }\n    else {\n      // todo: verify if this should or shouldn't happen silently\n      collection.add( data, { silent: true } );\n    }\n\n    // return the data as if it was requested by an api request\n    return collection.revertParse && typeof collection.revertParse === 'function' ?\n              collection.revertParse() :\n              collection.toJSON();\n  },\n\n  // get the resource if it is available in memory\n  // returns the object or if the object is not found it returns\n  // null ( to comply with the localStorage specs)\n  _memoryGet : function(resource) {\n    return this._memory ? this._memory[resource] : null;\n  },\n\n  // set the resource data in memory\n  _memorySet : function(resource, data) {\n    this._memory = this._memory || {};\n    this._memory[resource] = data;\n  },\n\n  // get the resource if it is available in localStorage\n  // returns the object or if the object is not found null\n  _storageGet : function(resource) {\n    var result;\n    try {\n      result = localStorage.getItem(this._getKey(resource));\n    } catch(e) {\n      return null;\n    }\n    return (result === undefined || result === 'undefined' || result === null) ? null : JSON.parse(result);\n  },\n\n  // set the resource data in localStorage\n  _storageSet : function(resource, data) {\n    var key = this._getKey(resource),\n        keys;\n    try {\n      keys = localStorage.getItem('monaco-' + this._app.name + ':keys') || '{}';\n    }\n    catch(e) {\n      return; // fail silently\n    }\n\n    var newKeys = JSON.parse(keys);\n    newKeys[key] = data._ts;\n    try {\n      localStorage.setItem('monaco-' + this._app.name + ':keys', JSON.stringify(newKeys));\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch(e) {\n      // todo: add a warning here\n      try {\n        // resetting the keys to its original value if either the new keys or data failed\n        localStorage.setItem('monaco-' + this._app.name + ':keys', keys);\n      } catch(exception) {\n        // fail silently - todo: add a warning here\n      }\n    }\n  },\n\n  // add the expire timestamp to the data object\n  _setExpire : function(data, expire, asProperty) {\n    var timestamp = null;\n    expire = ( _.isNumber( expire ) || _.isNull( expire ) ) ? expire : void 0;\n    if ( !_.isNull( expire ) ) {\n      var date = new Date();\n      date.setMinutes( date.getMinutes() + ( expire || this.cacheExpire ) );\n      timestamp = date.getTime();\n    }\n    // if asProperty is set to true then append the timestamp to the data\n    // usefull for setting expire for individual methods\n    if (asProperty === true) {\n      data._ts = timestamp;\n      return data;\n    }\n    return {\n      _ts : timestamp,\n      resp : data\n    };\n  },\n\n  // check if the data object is expired\n  _isExpired : function(data) {\n    var expire = data._ts,\n        now = new Date();\n    return ( !_.isNull( expire ) && now.getTime() > expire );\n  },\n\n  // clear a resource item from localStorage and memory\n  _clearItem : function(resource) {\n    var key = this._getKey(resource);\n    // remove the item from local storage\n    try {\n      localStorage.removeItem(key);\n    } catch(e) {\n      throw new Error('Monaco :: unable to remove the localStorage key: ' + key);\n    }\n\n    // remove the item from memory\n    if ( _.has(this._memory, resource) ) {\n      delete this._memory[resource];\n    }\n\n    // clean-up the application keys\n    var keys;\n    try {\n      keys = JSON.parse(localStorage.getItem('monaco-' + this._app.name + ':keys')) || {};\n    } catch(e) {}\n    if (keys) {\n      delete keys[key];\n      return this._app.set('monaco-' + this._app.name + ':keys', keys, true);\n    }\n  },\n\n  // clear all resources associated with this application from localStorage and memory\n  _clearAll : function() {\n    // clean up localStorage\n    var keys = {};\n    try {\n      keys = JSON.parse(localStorage.getItem('monaco-' + this._app.name + ':keys')) || {};\n    } catch(e) {}\n    _.each(keys, function(value, key) {\n      try {\n        var resource = key.split('#');\n        resource = resource[1];\n        localStorage.removeItem(key);\n      } catch(e) {\n        // do nothing\n      }\n    }, this);\n\n    // clean up memory\n    this._memory = {};\n\n    // clean-up the application keys\n    this._app.set('monaco-' + this._app.name + ':keys', {}, true);\n  },\n\n  // get a key based on the resource name and the application\n  _getKey : function(resource) {\n    return this._app.name + '#' + resource;\n  }\n};\n\nvar collectionInitialize = Monaco.Collection.prototype.initialize;\nMonaco.Collection.prototype.initialize = function() {\n\n  this._cacheCollection = function(options) {\n    var data;\n\n    // if original call IS NOT a fetch from local storage and this collection\n    // should be cached\n    if (this._app && !options.fromLocal &&\n      (_.result(this, 'cacheLocal') === true || this._app.local.autoCache === true)) {\n\n      // make sure the data has the same structure as the original server request\n      data = ( this.revertParse && typeof this.revertParse === 'function' ) ? this.revertParse() : this.toJSON();\n\n      // replace the local data with the new data\n      this._app.local.set(this, data);\n    }\n  };\n\n  // remove the collection from local storage if it is reset\n  this.on('reset', function() {\n    var options = arguments.length > 0 ? arguments[arguments.length - 1] : {},\n        resource = _.result(this, 'resource');\n\n    if (resource && this.length > 0) {\n      this._cacheCollection(options);\n    }\n    else if (resource) {\n      this._app.local.clear(resource);\n    }\n  } );\n\n  // todo: the `remove` and `add` events are called once per each model what causes\n  //       this method to reset the collection multiple times, if there was a way of\n  //       knowing that a certain event is the last in a series of events fired then\n  //       we could minimize the number of times we reset the collection local cache\n\n  // info: don't need to listen for the `destroy` model event, because it will\n  //       trigger a remove from the collection\n\n  // listen to collection events and updates local caching accordingly\n  this.on('add remove change', function() {\n    var options = arguments.length > 0 ? arguments[arguments.length - 1] : {};\n\n    this._cacheCollection(options);\n  }, this);\n  return collectionInitialize.apply(this, arguments);\n};\n\nvar modelInitialize = Monaco.Model.prototype.initialize;\nMonaco.Model.prototype.initialize = function() {\n  this._cacheModel = function(options) {\n    var data;\n\n    // if original call IS NOT a fetch from local storage and this collection\n    // should be cached\n    if (this._app && !options.fromLocal &&\n        (_.result(this, 'cacheLocal') === true || this._app.local.autoCache === true)) {\n\n      // make sure the data has the same structure as the original server request\n      data = ( this.revertParse && typeof this.revertParse === 'function' ) ? this.revertParse() : this.toJSON();\n\n      // replace the local data with the new data\n      this._app.local.set(this, data);\n    }\n  };\n\n  // listen to collection events and updates local caching accordingly\n  this.on('change', function() {\n    var options = arguments.length > 0 ? arguments[arguments.length - 1] : {};\n\n    this._cacheModel(options);\n  }, this);\n  return modelInitialize.apply(this, arguments);\n};\n\n/* -- SYNC ------------------------------------------------------------- */\nMonaco.sync = Backbone.sync;\n\n// override the Monaco (Backbone) sync method, so that read calls make\n// usage of the local caching data for Monaco Models or Collections\nBackbone.sync = function(method, model, options) {\n  options = options || {};\n  var app = model._app, // A Monaco Model or Collection will have a reference to the application\n      localOnly = (options.localOnly === true || model.localOnly === true);\n  if (app && method === 'read') {\n    // Attempt to retrieve the data from local cache and if succeed it will call the appropriated success method\n    var data = (options.fresh === true ) ? null : app.local.get(model);\n    if (data) {\n      options.fromLocal = true;\n      if (options.success) {\n        options.success(data);\n      }\n      return true;\n    }\n\n    var isCollection = _.has(model, 'models');\n\n    // call the `error` callback if no data is found and `localOnly` is set to true\n    if (localOnly === true) {\n      if (options.error) {\n        options.error({}, 'Error: resource not found locally', {});\n      }\n      return;\n    }\n    // Check the configuration levels and wrap the success call back if at any level we have cacheLocal defined\n    // If we have a custom cache control key, we want to cache regardless of whether the object wants to cache or not\n    else {\n      var cacheLocal = false,\n          success;\n\n      var customCachePolicy = (isCollection && model.cachePolicy) ? model.cachePolicy :\n                                (!isCollection && model.collection) ? model.collection.cachePolicy :\n                                  (app.options.cachePolicy) ? app.options.cachePolicy : void 0;\n\n      //Determine if we need to do local caching\n\n      //Case 1: Custom Caching Policy supposedly sent by server response\n      cacheLocal = (customCachePolicy && customCachePolicy !== 'local');\n\n      //Case 2: cacheLocal specified to be true at app/collection/model/fetch level\n      if ((_.result(options, 'cacheLocal') === true) || // fetch level\n          (!_.has(options, 'cacheLocal') &&  isCollection && _.result(model, 'cacheLocal') === true) || // collection level\n            (!_.has(options, 'cacheLocal') && (!isCollection && model.collection) && _.result(model.collection, 'cacheLocal') === true) || // model (with collection) level\n              (!_.has(options, 'cacheLocal') && (!isCollection && !model.collection) && _.result(model, 'cacheLocal') === true) || // model (no collection) level\n                  (!_.has(options, 'cacheLocal') && (!_.has(model, 'cacheLocal')) && app.local.autoCache === true)) { // app level\n        cacheLocal = true;\n      }\n\n      if (cacheLocal) {\n        success = options.success;\n        options.success = function(resp, status, xhr) {\n\n          // local caching policy will use the expiration defined or Monaco's default\n          if (!customCachePolicy || customCachePolicy === 'local') {\n            app.local.set(model, resp, _.result(options, 'expireLocal'));\n          }\n\n          // custom caching policy will use the expiration sent by the server\n          // and if not available or too small it won't cache the resource\n          else {\n            var expire = xhr.getResponseHeader(customCachePolicy);\n            if (expire) {\n              // Cache-Control sends expire time in seconds, but Monaco uses minutes\n              expire = parseInt(expire.match(/max-age=([\\d]+)/)[1], 10);\n              if (expire && ((expire / 60) > 0)) {\n                app.local.set(model, resp, (expire / 60));\n              }\n            }\n          }\n\n          if (success) {\n            success.apply(this, arguments);\n          }\n        };\n      }\n    }\n  }\n\n  // return earlier for model/collections or request options set to localOnly\n  if (localOnly === true) {\n    return;\n  }\n  return Monaco.sync(method, model, options);\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Overrides backbone navigation system in order to provide page tracking\n * ps: by default it uses Google Analytics\n *     to integrate it with other platforms check the docs.\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// keep a reference to the original `loadUrl` method from Monaco\nvar loadUrl = this.Monaco.History.prototype.loadUrl,\n    self = this;\n\n// overridden method to inject a call to track page views\nMonaco.History.prototype.loadUrl = function() {\n  var matched = loadUrl.apply(this, arguments),\n      pvFragment = this.fragment;\n\n  if (!/^\\//.test(pvFragment)) {\n    pvFragment = '/' + pvFragment;\n  }\n  this.trackPageview(pvFragment);\n  return matched;\n};\n\n// Override this method if you are not using google analytics, but\n// instead another analytics service to track page views\nMonaco.History.prototype.trackPageview = function(fragment) {\n  if( self.ga !== void 0 ) {\n    self.ga('send', 'pageview', fragment);\n  }\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Experiments monaco class, used to work with application experiments\n * ps: by default `Monaco.Experiments` uses Google Analytics to log experiment events\n *     to integrate it with other platforms check the docs.\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// Transition Application setup\nMonaco.on('app:built', function(app, options) {\n  app.experiments = new Monaco.Experiments(options.experiments);\n});\n\n/* -- MAIN OBJECT ------------------------------------------------------ */\n// Experiments Constructor\nvar Experiments = Monaco.Experiments = function(options) {\n  options = options || {};\n  this._experiments = []; // internal list of experiments\n\n  // merge the default options with the custom options received\n  this.options = _.extend({\n    ga : {slot : 1, scope: 2},\n    cookie : {prefix: 'ab-', days: 360, baseDomain: false }\n  }, options);\n};\n\nExperiments.prototype = _.extend(Experiments.prototype, {\n  // remove the experiment reference from the internal list\n  // _removeReference: function(experiment) {\n  //     var index = this._experiments.indexOf(experiment);\n  //     if (index >= 0) {\n  //         this._experiments.splice(index, 1);\n  //     }\n  // },\n\n  // returns an experiment object based on a key search\n  get: function(key) {\n    return _.find(this._experiments, function(experiment) {\n      return experiment.key === key;\n    });\n  },\n\n  // set an experiment object in the internal list of experiments\n  set: function(key, groups, options) {\n    var experiment = key;\n    if ( !(experiment instanceof Monaco.Experiment) ) {\n      experiment = new Monaco.Experiment(this, key, groups, _.extend({}, this.options, options));\n    }\n    this._experiments.push(experiment);\n  },\n\n  // remove all split tests\n  // remove: function() {\n  //     _.each(this._experiments, function(experiment) {\n  //         experiment.remove();\n  //     });\n  // },\n\n  // opt-out the current user from all experiments\n  optout: function() {\n    _.each(this._experiments, function(experiment) {\n      experiment.optout();\n    });\n  },\n\n  // split all active experiments\n  split: function() {\n    _.each(this._experiments, function(experiment, index) {\n      experiment.split();\n    });\n  }\n});\n\n/* -- Individual Experiment Object ------------------------------------------- */\nvar Experiment = Monaco.Experiment = function(parent, key, groups, options) {\n  // Every experiment needs a key\n  if ( !key ) {\n    throw new Error('Monaco :: failed to create the experiment: ' + key + ' - experiment key required' );\n  }\n  groups = groups || {};\n  options = options || {};\n  options.users = options.users || 0;\n  // the percentage of users to participate on the experiment should be between 0 and 1\n  if ( !_.isNumber( options.users ) || options.users > 1 || options.users < 0 ) {\n    throw new Error('Monaco :: failed processing experiment: \\'' + key + '\\' - users not defined within allowed range' );\n  }\n  // since the variations will be chosen evenly you can't have more variations than\n  // the percentage number of users participating in the experiment\n  this.usersPerGroup = Math.floor( ( options.users * 100 ) / _.size( groups ) );\n  if ( this.usersPerGroup < 1 ) {\n    throw new Error('Monaco :: failed processing experiment: \\'' + key + '\\' - individual groups set to less than 1%' );\n  }\n  this.parent = parent;\n  this.key = key;\n  this.groups = groups;\n  this.normalized = this._normalizeGroup( groups );\n  // this.cookiePrefix = options.cookie.prefix || 'ab-';\n  this.options = options;\n  this.cookie = {\n    set : Monaco.utils.setCookie,\n    get : Monaco.utils.getCookie\n  };\n};\n\n// normalize groups based on the percentage set for each group\nExperiment.prototype = _.extend(Experiment.prototype, {\n  // original group key used when the user is not assigned to any variation\n  original: '__original__',\n\n  // keep track of the current variation this user is assigned to after splitting this experiment\n  current: null,\n\n  // split this experiment returning the group this user has been set for this experiment\n  split: function() {\n    if (!this.current) {\n      var cookieOpt = this.options.cookie,\n          groupKey = this.cookie.get(cookieOpt.prefix + this.key);\n      if(!groupKey) {\n        groupKey = this.normalized[Math.floor( Math.random() * this.normalized.length )];\n        this.cookie.set(cookieOpt.prefix + this.key, groupKey, cookieOpt.days, cookieOpt.baseDomain);\n        this.saveGroup(groupKey);\n      }\n      // this.current = groupKey === this.original ? groupKey : this.groups[groupKey];\n      this.current = groupKey;\n    }\n\n    return this.current;\n  },\n\n  // return the value of a variation based on its key\n  // if no key is provided and the split was already done\n  // this method will return the value of the chosen group\n  get: function(key) {\n    if (!key && this.current) {\n      return this.groups[this.current];\n    } else if ( !key ) {\n      return void 0;\n    }\n    return this.groups[key];\n  },\n\n  // helper method that will return the name of the controller based on this experiment variation\n  controller: function(methodName) {\n    return !this.current || this.current === this.original ? methodName : methodName + this.get(this.current).suffix;\n  },\n\n  // helper method that will return the class name for the view based on this experiment variation\n  view: function(ViewClass) {\n    return !this.current || this.current === this.original ? ViewClass : ViewClass + this.get(this.current).suffix;\n  },\n\n  // helper method that will return the class name for the template based on this experiment variation\n  template: function(template) {\n    return !this.current || this.current === this.original ? template : template + '.' + this.get(this.current).suffix;\n  },\n\n  // remove this experiment\n  // remove: function() {\n  //     var cookieOpt = this.options.cookie;\n  //     this.current = null;\n  //     this.cookie.set(cookieOpt.prefix + this.key, '', -1, cookieOpt.baseDomain);\n  //     this.parent._removeReference(this);\n  // },\n\n  // optout the current user from a specific experiment, basically setting the cookie\n  // to the `this.original` property value value\n  optout: function() {\n    var cookieOpt = this.options.cookie;\n    this.cookie.set(cookieOpt.prefix + this.key, this.original, cookieOpt.days, cookieOpt.baseDomain);\n  },\n\n  // saves the experiment data, when a user joins one variation of the experiment\n  // override this method if you want to use another service other than Google Analytics\n  saveGroup: function(groupKey) {\n    _gaq.push(['_setCustomVar', this.options.ga.slot, this.key, groupKey, this.options.ga.scope]);\n    _gaq.push(['_trackEvent', 'experiments', 'join', (this.key + '|' + groupKey)]);\n  },\n\n  toJSON: function() {\n    return {\n      current: this.current,\n      group: this.get(),\n      groups: this.groups\n    };\n  },\n\n  // returns an array of 100 items based on the probability of each group\n  _normalizeGroup: function(groups) {\n    var normalized = [],\n        count = 0;\n    for (var groupKey in groups) {\n      if (groups.hasOwnProperty(groupKey)) {\n        for (var i=0, j=this.usersPerGroup; i < j; i++) {\n          normalized.push(groupKey);\n          count++;\n        }\n      }\n    }\n\n    var remaining = 100 - count;\n    while (--remaining >=0) {\n      normalized.push(this.original);\n    }\n    return normalized;\n  }\n});\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Transition monaco class to help applications ui transition state\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\nvar utils = Monaco.utils = Monaco.utils || {};\n\n// Transition Application setup\nMonaco.on('app:built', function(app, options) {\n  app.transitions    = {}; // transition list\n});\n\n// transition from currentView to targetView\nMonaco.Application.prototype.transitionTo = function(targetView, options, Transition) {\n  if (!targetView) {\n    throw new Error('Monaco :: missing target view');\n  }\n\n  var currentView = (this.currentView || null),\n      TransitionClass = Transition || this.transitions.DefaultTransition || Monaco.Transition,\n      transition = new TransitionClass();\n\n  this.currentView = transition.start(currentView, targetView, options);\n};\n\n/* -- TRANSITION ------------------------------------------------------- */\nvar Transition = Monaco.Transition = function(options) {\n  this.initialize.apply(this, arguments);\n};\n\n// extend the Monaco.Transition with Backbone.Events engine\n_.extend(Monaco.Transition.prototype, Backbone.Events, {\n  // application namespace\n  namespace : 'transitions',\n\n  // initialization - Override it with your own logic\n  initialize : function() {},\n\n  // execute the transition - override this method when creating custom transitions\n  // returns the view that will be assigned to the application currentView\n  start : function(fromView, toView, options) {\n    options = options || {};\n    if (fromView && toView.el === fromView.el) {\n      fromView.remove();\n      toView.render(options);\n    }\n    else if (fromView) {\n      toView.render(options);\n      fromView.remove();\n    } else {\n      toView.render(options);\n    }\n    return toView;\n  }\n});\n\nTransition.extend = utils.extend;\n\nreturn Monaco;\n}));\n"],"sourceRoot":"/source/"}